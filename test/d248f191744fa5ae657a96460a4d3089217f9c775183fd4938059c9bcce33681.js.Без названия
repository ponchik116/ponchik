!function(){"use strict";var v=Roblox,h=CoreRobloxUtilities,r="/upgrades/paymentmethods",m="/info/terms",u="ItemPurchaseAjaxData",d="/games/",c="CommonUI.Controls",p="Feature.Premium",o="/v1/users/{userId}/currency",s="/game-passes/v1/game-passes/{productId}/purchase",E="/v1/purchases/products/{productId}",i="/v1/products/{productId}",y="/purchase-warning/v1/purchase-warnings",f="/purchase-warning/v1/purchase-warnings/acknowledge",l="Success",U=5e3,S={GAME_PASS:"Game Pass",BUNDLE:"Bundle",BUNDLE_ALIAS:"Package"},A={GAME_PASS:"/v1/game-passes",BUNDLE:"/v1/bundles/thumbnails",ASSET:"/v1/assets"},T={size:"150x150",format:"Png",isCircular:!1},P={backToShopAction:"Action.BackToShop",buyRobuxAndItemAction:"Action.BuyRobuxAndItem",buyRobux:"Action.BuyRobux",cancelAction:"Action.Cancel",equipMyAvatarAction:"Action.EquipMyAvatar",goToRobuxStoreAction:"Action.GoToRobuxStore",insufficientRobuxHeading:"Heading.InsufficientRobux",insufficientRobuxMessage:"Message.InsufficientRobux",insufficientRobuxLeaveRobloxHeading:"Heading.InsufficientRobuxLeaveRoblox",insufficientRobuxAskToPurchasePackageMessage:"Message.InsufficientRobuxAskToPurchasePackage",insufficientRobuxExceedLargestPackageMessage:"Message.InsufficientRobuxExceedLargestPackage",insufficientRobuxRedirectToExternalPartner:"Message.InsufficientRobuxRedirectToExternalPartner",purchaseSucceededHeading:"Heading.PurchaseSucceeded",purchaseSucceededMessage:"Message.PurchaseSucceeded",purchaseSucceededRobuxBalanceMessage:"Message.PurchaseSucceededRobuxBalance",purchasingTheItemLabel:"Label.PurchasingTheItem",waitingForRobuxLabel:"Label.WaitingForRobux",errorOccuredHeading:"Heading.ErrorOccured",purchasingUnavailableMessage:"Message.PurchasingUnavailable",purchaseErrorOccuredMessage:"Message.PurchaseErrorOccured",okAction:"Action.Ok",commonUiOkAction:"Action.OK",commonUiCancelAction:"Action.Cancel",commonUiContinueToPaymentAction:"Action.ContinueToPayment",featurePremiumScaryModalTitleHeading:"Heading.ScaryModalTitle",featurePremiumScaryModalBodyNewDescription:"Description.ScaryModalBodyNew",featurePremiumScaryModalBody13To17Description:"Description.ScaryModalBody13To17",featurePremiumScaryModalThreshold1BodyDescription:"Description.ScaryModalThreshold1Body",featurePremiumScaryModalThreshold2BodyDescription:"Description.ScaryModalThreshold2Body"},_={U13PaymentModal:"U13PaymentModal",ParentalConsentWarningPaymentModal13To17:"ParentalConsentWarningPaymentModal13To17",ParentalAuthorization13To17:"ParentalAuthorization13To17",U13MonthlyThreshold1Modal:"U13MonthlyThreshold1Modal",RequireEmailVerification:"RequireEmailVerification",U13MonthlyThreshold2Modal:"U13MonthlyThreshold2Modal",NoAction:"NoAction"},b={EVENT_NAME:"ItemPurchaseUpsellEvent",CONTEXT_NAME:{COOKIE_PARSE_FAILED:"COOKIE_PARSE_FAILED",PRODUCT_INFO_REQUEST_FAILED:"PRODUCT_INFO_REQUEST_FAILED",PRODUCT_INFO_EMPTY:"PRODUCT_INFO_EMPTY",PRODUCT_ID_NOT_EXIST:"PRODUCT_ID_NOT_EXIST",UPSELL_FAILED:"UPSELL_FAILED"}},t="WebCatalog",a="WebBundle",w="WebGamePass",g="NoTypeParsedYet",M={UnknownError:"UnknownError",UnknownErrorNoAsset:"UnknownErrorNoAsset",UpsellShown:"UpsellShown",UpsellCancelled:"UpsellCancelled",UpsellCancelledFromU13Modal:"UpsellCancelledFromU13Modal",UpsellContinued:"UpsellContinued",UpsellThumbnailProcessFailed:"UpsellThumbnailProcessFailed",ContinueBuyRobuxOnExternalSite:"ContinueBuyRobuxOnExternalSite",LeaveRobloxFailedToShown:"LeaveRobloxFailedToShown",CancelledFromLeaveRobloxModal:"CancelledFromLeaveRobloxModal",ConfirmLeaveRobloxModal:"ConfirmLeaveRobloxModal",UpsellExceedLargestEntryPoint:"UpsellExceedLargestEntryPoint",UpsellExceedLargestShown:"UpsellExceedLargestShown",UpsellExceedLargestCancelled:"UpsellExceedLargestCancelled",UpsellExceedLargestGoToRobuxStoreClicked:"UpsellExceedLargestGoToRobuxStoreClicked",UpsellExceedLargestModalExpTrue:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpFalse:"UpsellExceedLargestModalExpTrue",UpsellExceedLargestModalExpError:"UpsellExceedLargestModalExpError",UpsellExceedLargestMetadataError:"UpsellExceedLargestMetadataError",UpsellExceedLargestNoThumbnailImage:"UpsellExceedLargestNoThumbnailImage",UpsellFromGamesPage:"UpsellFromGamesPage",UpsellFailed:"UpsellFailed",UpsellFailedDueToNoAvailablePackage:"UpsellFailedDueToNoAvailablePackage",UpsellFailedDueToFailedPackageRequest:"UpsellFailedDueToFailedPackageRequest",AutoPurchaseEntryPoint:"AutoPurchaseEntryPoint",AutoPurchaseStarted:"AutoPurchaseStarted",AutoPurchaseSucceed:"AutoPurchaseSucceed",AutoPurchaseSucceedClose:"AutoPurchaseSucceedClose",AutoPurchaseSucceedBackToShop:"AutoPurchaseSucceedBackToShop",AutoPurchaseSucceedEquipMyAvatar:"AutoPurchaseSucceedEquipMyAvatar",AutoPurchaseFailed:"AutoPurchaseFailed",AutoPurchaseErrorFromPurchaseApi:"AutoPurchaseErrorFromPurchaseApi",AutoPurchaseFailedDueToStillLowBalance:"AutoPurchaseFailedDueToStillLowBalance",AutoPurchasePotentialHackingActionSpotted:"AutoPurchasePotentialHackingActionSpotted",AutoPurchasePotentialHackingActionSpotted2:"AutoPurchasePotentialHackingActionSpotted2",AutoPurchasePotentialHackingActionSpotted3:"AutoPurchasePotentialHackingActionSpotted3",AutoPurchasePotentialHackingActionSpotted4:"AutoPurchasePotentialHackingActionSpotted4",ShowU13PaymentModal:"ShowU13PaymentModal",ShowU13MonthlyThreshold1Modal:"ShowU13MonthlyThreshold1Modal",ShowU13MonthlyThreshold2Modal:"ShowU13MonthlyThreshold2Modal",ShowParentalConsentWarningPaymentModal13To17Modal:"ShowParentalConsentWarningPaymentModal13To17Modal",ConfirmU13PaymentModal:"ConfirmU13PaymentModal",ConfirmU13MonthlyThreshold1Modal:"ConfirmU13MonthlyThreshold1Modal",ConfirmU13MonthlyThreshold2Modal:"ConfirmU13MonthlyThreshold2Modal",ConfirmParentalConsentWarningPaymentModal13To17Modal:"ConfirmParentalConsentWarningPaymentModal13To17Modal",U13PaymentModalEmailVerificationTriggered:"U13PaymentModalEmailVerificationTriggered",U13PaymentModalFailedToShow:"U13PaymentModalFailedToShow",U13PaymentModalNoAction:"U13PaymentModalNoAction"},I=CoreUtilities,x=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},N=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function C(e,t){return void 0===t&&(t=!0),t?"<span class='icon-robux-16x16'></span><span class='text-robux'>"+v.NumberFormatting.commas(e)+"</span>":"<span class='icon-robux-gray-16x16'></span><span class='text'>"+v.NumberFormatting.commas(e)+"</span>"}var R=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},L=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function F(){var e;h.upsellUtil.expireUpsellCookie(),window.history&&((e=new URL(window.location.href)).searchParams.delete(h.upsellUtil.constants.UPSELL_QUERY_PARAM_KEY),e=e.href,window.history.pushState({path:e},"",e))}var O=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},G=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},B=window.EventTracker?EventTracker:{fireEvent:console.log,start:console.log,endSuccess:console.log,endCancel:console.log,endFailure:console.log};function D(e){(0,B.fireEvent)(t+e)}function k(e,t){var n;t===S.BUNDLE||t===S.BUNDLE_ALIAS?(n=e,(0,B.fireEvent)(a+n)):t===S.GAME_PASS?(n=e,(0,B.fireEvent)(w+n)):D(t?e:M.UnknownErrorNoAsset)}function W(e,t,n,a,r){var o=a.getTranslationResource(p),i=a.getTranslationResource(c),l="<br /><br />",a={lineBreak:l,linebreak:l},l="";t===_.U13PaymentModal?l=o.get(P.featurePremiumScaryModalBodyNewDescription,a):t===_.ParentalConsentWarningPaymentModal13To17?l=o.get(P.featurePremiumScaryModalBody13To17Description,{}):t===_.U13MonthlyThreshold1Modal?l=o.get(P.featurePremiumScaryModalThreshold1BodyDescription,a):t===_.U13MonthlyThreshold2Modal&&(l=o.get(P.featurePremiumScaryModalThreshold2BodyDescription,a)),v.Dialog.open({titleText:o.get(P.featurePremiumScaryModalTitleHeading,{}),bodyContent:'<div><span class="text-description">'+l+'</span></div><div class="text-center"><div class="icon-warning"></div></div>',declineText:i.get(P.commonUiCancelAction,{}),acceptText:i.get(P.commonUiOkAction,{}),onAccept:function(){return function(a,r){return O(this,void 0,Promise,function(){var t,n;return G(this,function(e){switch(e.label){case 0:n={acknowledgement:"Confirmed"+a},t={url:""+v.EnvironmentUrls.apiGatewayUrl+f,withCredentials:!0,timeout:U},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.post(t,n)];case 2:return e.sent(),r(),[2,Promise.resolve()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}(t,n).then(function(){t===_.U13PaymentModal?k(M.ConfirmU13PaymentModal,null==r?void 0:r.assetType):t===_.U13MonthlyThreshold1Modal?k(M.ConfirmU13MonthlyThreshold1Modal,null==r?void 0:r.assetType):t===_.U13MonthlyThreshold2Modal?k(M.ConfirmU13MonthlyThreshold2Modal,null==r?void 0:r.assetType):k(M.ConfirmParentalConsentWarningPaymentModal13To17Modal,null==r?void 0:r.assetType)}).catch(function(){n()}),!1},onDecline:function(){return k(M.UpsellCancelledFromU13Modal,null==r?void 0:r.assetType),F(),!1},onCancel:function(){return k(M.UpsellCancelledFromU13Modal,null==r?void 0:r.assetType),F(),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}var e=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},V=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function H(e){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN,e)}function X(n,a,r,o,i){var l;return e(this,void 0,void 0,function(){var t;return V(this,function(e){switch(e.label){case 0:if(!a)return r(),[2,Promise.resolve()];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(r){return R(this,void 0,Promise,function(){var t,n,a;return L(this,function(e){switch(e.label){case 0:n=!v.CurrentUser.isPremiumUser,t={productId:r,is13To17ScaryModalEnabled:n},n={url:""+v.EnvironmentUrls.apiGatewayUrl+y,withCredentials:!0,timeout:U},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.get(n,t)];case 2:return 200===(a=e.sent()).status&&a.data.action?[2,Promise.resolve(a.data.action)]:[2,Promise.resolve(_.NoAction)];case 3:return a=e.sent(),[2,Promise.reject(a)];case 4:return[2]}})})}(n.roblox_product_id)];case 2:return(t=e.sent())===_.U13PaymentModal||t===_.ParentalConsentWarningPaymentModal13To17||t===_.U13MonthlyThreshold1Modal||t===_.U13MonthlyThreshold2Modal?(t===_.U13PaymentModal?(H(h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_PAYMENT_MODAL),k(M.ShowU13PaymentModal,null==i?void 0:i.assetType)):t===_.U13MonthlyThreshold1Modal?(H(h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_1_MODAL),k(M.ShowU13MonthlyThreshold1Modal,null==i?void 0:i.assetType)):t===_.U13MonthlyThreshold2Modal?(H(h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.U13_MONTHLY_THRESHOLD_2_MODAL),k(M.ShowU13MonthlyThreshold2Modal,null==i?void 0:i.assetType)):(H(h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.PAYMENT_MODAL_13_TO_17),k(M.ShowParentalConsentWarningPaymentModal13To17Modal,null==i?void 0:i.assetType)),W(0,t,r,o,i)):t===_.RequireEmailVerification?(k(M.U13PaymentModalEmailVerificationTriggered,null==i?void 0:i.assetType),null!==(l=v.EmailVerificationService.handleUserEmailVerificationRequiredByPurchaseWarning())&&void 0!==l&&l.then(function(e){H(h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.REQUIRE_EMAIL_VERIFICATION),null!=e&&e.emailAddress&&null!=e&&e.verified&&r()})):(k(M.U13PaymentModalNoAction,null==i?void 0:i.assetType),r()),[2,Promise.resolve()];case 3:return t=e.sent(),[2,Promise.reject(t)];case 4:return[2]}})})}var n=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},Y=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function j(i,l,s){return n(this,void 0,void 0,function(){return Y(this,function(e){try{return h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.LEAVE_ROBLOX_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.EXTERNAL_LINK_MODAL),k(M.ContinueBuyRobuxOnExternalSite,null==s?void 0:s.assetType),t=i,a=s,r=(n=l).getTranslationResource(p),o=n.getTranslationResource(c),n={lineBreak:n="<br /><br />",linebreak:n},n=r.get(P.insufficientRobuxAskToPurchasePackageMessage,n)||"This purchase must be completed on our partner’s website. You will be returned to Roblox after the purchase is completed.<br /><br /> Proceed to partner website for payment?",v.Dialog.open({titleText:r.get(P.insufficientRobuxLeaveRobloxHeading,{})||"Leaving Roblox",bodyContent:"<div class='modal-message-block text-center'>"+n+"</div>",declineText:o.get(P.commonUiCancelAction,{}),acceptText:o.get(P.commonUiContinueToPaymentAction,{})||"Continue to Payment",onAccept:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.LEAVE_ROBLOX_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CONTINUE_TO_VNG),k(M.ConfirmLeaveRobloxModal,null==a?void 0:a.assetType),t()},onDecline:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.LEAVE_ROBLOX_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.CancelledFromLeaveRobloxModal,null==a?void 0:a.assetType)},onCancel:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.LEAVE_ROBLOX_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.CancelledFromLeaveRobloxModal,null==a?void 0:a.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0}),[2,Promise.resolve()]}catch(e){return[2,Promise.reject(e)]}var t,n,a,r,o;return[2]})})}function q(e){h.upsellUtil.expireUpsellCookie(),window.location.href=v.Endpoints.getAbsoluteUrl(e)}function K(){window.location.href="https://shop.vnggames.com/global"}function Q(e,t,n){var a=function(e){var t=h.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname);h.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0;var n=null;if(Array.isArray(t)&&0<t.length&&(n=t[0]),!n)return"";if(!e||Object.keys(e).length<4)return"";var a=I.uuidService.generateRandomUuid(),t=e.expectedCurrency+","+e.expectedPrice+","+e.expectedSellerId+","+(null!==(t=e.userassetId)&&void 0!==t?t:""),e=""+(e.productId||""),t=a+","+n+","+v.CurrentUser.userId+","+t+","+e;return(e=new Date).setHours(e.getHours()+1),e=[h.upsellUtil.constants.UPSELL_COOKIE_KEY,"=",encodeURIComponent(t),"; expires="+e.toUTCString(),"; path=/","; domain=.",v.EnvironmentUrls.domain,";"],document.cookie=e.join(""),a}(n);k(M.UpsellContinued,null==n?void 0:n.assetType),h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_PURCHASE_PAGE),window.location.href=I.urlService.getAbsoluteUrl(r+"?ap="+e.roblox_product_id+"&UpsellUuid="+a+")}")}function z(e,t,n,a,r,o,i){var l,s,c,u,d,p,E=C(t.expectedItemPrice),y="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+(null!==(u=n.thumbnailImageUrl)&&void 0!==u?u:"")+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,I.escapeHtml)()(t.assetName)+"</div>\n          <div class='text-robux item-card-price'>"+E+"</div>\n        </div>\n      </div>";k(M.UpsellShown,null===(n=t.buyButtonElementDataset)||void 0===n?void 0:n.assetType),h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),a.is_eligible_for_vng?(d=t,p=i,n=(u=y)+((E=o).get(P.insufficientRobuxAskToPurchasePackageMessage,{})||"<div class='modal-message-block text-center border-top'>Sorry, you don't have enough Robux to buy this item. Would you like to purchase a Robux package?</div>"),u=E.get(P.insufficientRobuxRedirectToExternalPartner,{})||"<div class='text-footer modal-message-block text-center'> You will be taken to our partner’s page to complete the purchase.</div>",v.Dialog.open({titleText:E.get(P.insufficientRobuxHeading,{})||"Insufficient Robux",bodyContent:n,declineText:E.get(P.cancelAction,{}),acceptText:E.get(P.buyRobux,{})||"Buy Robux",onAccept:function(){return h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.BUY_ROBUX),j(K,p,d.buyButtonElementDataset).catch(function(){var e;k(M.LeaveRobloxFailedToShown,null===(e=d.buyButtonElementDataset)||void 0===e?void 0:e.assetType),K()}),!1},onDecline:function(){var e;h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellCancelled,null===(e=d.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},onCancel:function(){var e;h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellCancelled,null===(e=d.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!0,footerText:u,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})):(y=y,e=e,l=t,s=a,r=r,o=o,c=i,i="<a class='text-link-secondary terms-of-use-link' target='_blank' href='"+I.urlService.getUrlWithLocale(m,r.getRobloxLocale())+"'>",r=C(e.shortfallPrice,!1),e=C(s.robux_amount),i=y+o.get(P.insufficientRobuxMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:r,robuxPackageAmount:e,lineBreak:"",aTagStart:i,aTagEnd:"</a>"}),v.Dialog.open({titleText:o.get(P.insufficientRobuxHeading,{}),bodyContent:i,declineText:o.get(P.cancelAction,{}),acceptText:o.get(P.buyRobuxAndItemAction,{}),acceptColor:"btn-primary-md",onAccept:function(){return h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.BUY_ROBUX_AND_ITEM),X(s,v.CurrentUser.isUnder13,function(){return Q(s,0,l.buyButtonElementDataset)},c,l.buyButtonElementDataset).catch(function(){var e;k(M.U13PaymentModalFailedToShow,null===(e=l.buyButtonElementDataset)||void 0===e?void 0:e.assetType),Q(s,0,l.buyButtonElementDataset)}),!1},onDecline:function(){var e;h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellCancelled,null===(e=l.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},onCancel:function(){var e;h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellCancelled,null===(e=l.buyButtonElementDataset)||void 0===e?void 0:e.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0}))}function J(){var n=this;this.overlayDiv=null,this.contentDiv=null,this.loadingMessageSpan=null,this.spinnerSpan=null,this.loadingOverlayElementId="loading-overlay",this.show=function(e){var t=n.getOrCreateOverlayDiv(),t=n.getOrCreateContentDiv(t);return n.getOrCreateSpinnerSpan(t),n.updateOrCreateMessage(e),n},this.hide=function(){var e;null!==(e=null===(e=n.spinnerSpan)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.spinnerSpan),null!==(e=null===(e=n.loadingMessageSpan)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.loadingMessageSpan),null!==(e=null===(e=n.contentDiv)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.contentDiv),null!==(e=null===(e=n.overlayDiv)||void 0===e?void 0:e.parentNode)&&void 0!==e&&e.removeChild(n.overlayDiv),n.overlayDiv=null,n.contentDiv=null,n.spinnerSpan=null,n.loadingMessageSpan=null},this.updateMessage=function(e){n._loadingMessage=e,n.updateOrCreateMessage(e)},this.updateOrCreateMessage=function(e){var t;if(n.overlayDiv)return e?void(n.loadingMessageSpan?n.loadingMessageSpan.innerText=e:((t=document.createElement("span")).innerText=e,t.classList.add("loading-message"),n.getOrCreateContentDiv(n.overlayDiv).appendChild(t),n.loadingMessageSpan=t)):(null!==(t=null===(t=n.loadingMessageSpan)||void 0===t?void 0:t.parentNode)&&void 0!==t&&t.removeChild(n.loadingMessageSpan),void(n.loadingMessageSpan=null))},this.getOrCreateContentDiv=function(e){if(n.contentDiv)return n.contentDiv;var t=document.createElement("div");return t.classList.add("loading-overlay-content"),n.contentDiv=t,e.appendChild(t),t},this.getOrCreateOverlayDiv=function(){if(n.overlayDiv)return n.overlayDiv;var e=document.getElementById(n.loadingOverlayElementId);if(e)return n.overlayDiv=e;e=document.createElement("div");return(n.overlayDiv=e).id=n.loadingOverlayElementId,e.classList.add("loading-overlay"),document.body.appendChild(e),e},this.getOrCreateSpinnerSpan=function(e){if(n.spinnerSpan)return n.spinnerSpan;var t=document.createElement("span");return t.classList.add("spinner","spinner-default"),e.appendChild(t),n.spinnerSpan=t}}var Z=(Object.defineProperty(J.prototype,"loadingMessage",{get:function(){return this._loadingMessage},enumerable:!1,configurable:!0}),J),$=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},ee=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},te=function(){return(te=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},ne=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},ae=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function re(e,t){try{v.EventStream.SendEventWithTarget(b.EVENT_NAME,e,t,v.EventStream.TargetTypes.WWW)}catch(e){}}var oe=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},ie=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function le(e){F(),q(e)}function se(e){e&&(e.startsWith("/catalog/")||e.startsWith("/bundles/")||e.startsWith("/game-pass/")||e.startsWith(d))&&!e.includes("UpsellUuid=")||(h.upsellUtil.expireUpsellCookie(),window.location.href=v.Endpoints.getAbsoluteUrl("/catalog"))}function ce(n,a){return oe(this,void 0,Promise,function(){var t;return ie(this,function(e){switch(e.label){case 0:if(!a)return[2,Promise.reject()];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(a){var r;return $(this,void 0,Promise,function(){var t,n;return ee(this,function(e){switch(e.label){case 0:t=i.replace("{productId}",a),t={url:""+v.EnvironmentUrls.economyApi+t,withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.get(t)];case 2:return 200!==(n=e.sent()).status||n.data.reason!==l?[2,Promise.reject(null===(r=null==n?void 0:n.data)||void 0===r?void 0:r.reason)]:[2,Promise.resolve(n.data)];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}(a)];case 2:return(t=e.sent())&&0!==Object.keys(t).length?[2,t]:(k(M.AutoPurchasePotentialHackingActionSpotted3,g),re(b.CONTEXT_NAME.PRODUCT_INFO_EMPTY,{itemPath:n,productId:a}),[2,Promise.reject()]);case 3:return t=e.sent(),k(M.AutoPurchasePotentialHackingActionSpotted4,g),re(b.CONTEXT_NAME.PRODUCT_INFO_REQUEST_FAILED,{itemPath:n,productId:a,error:t}),[2,Promise.reject(t)];case 4:return[2]}})})}function ue(o,i,l){return oe(this,void 0,Promise,function(){var t,n,a,r;return ie(this,function(e){switch(e.label){case 0:(r=h.upsellUtil.parseUpsellCookie())&&0!==Object.keys(r).length&&(!r.targetItemUrl||o.startsWith(r.targetItemUrl))||(k(M.AutoPurchasePotentialHackingActionSpotted2,g),re(b.CONTEXT_NAME.COOKIE_PARSE_FAILED,{itemPath:o,upsellCookieData:r}),le(o)),(t=i)||le(o),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,ce(o,r.productId)];case 2:return n=e.sent(),[3,4];case 3:return a=e.sent(),re(b.CONTEXT_NAME.PRODUCT_ID_NOT_EXIST,{itemPath:o,upsellCookieData:r,error:a}),le(o),[2,Promise.reject()];case 4:return[4,function(a,r){return ne(this,void 0,Promise,function(){var t,n;return ae(this,function(e){switch(e.label){case 0:n=r===S.GAME_PASS?(t=A.GAME_PASS,{gamePassIds:a}):r===S.BUNDLE?(t=A.BUNDLE,{bundleIds:a}):(t=A.ASSET,{assetIds:a}),n=te(te({},n),T),t={url:""+v.EnvironmentUrls.thumbnailsApi+t,withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.get(t,n)];case 2:return 200===(n=e.sent()).status&&n.data.data&&0!==n.data.data.length?[2,Promise.resolve(n.data.data[0].imageUrl)]:[2,Promise.resolve(null)];case 3:return e.sent(),[2,Promise.resolve(null)];case 4:return[2]}})})}(n.assetId,n.assetType)];case 5:return a=e.sent(),t.imageurl=a||t.imageurl,r={expectedPrice:r.expectedPrice||"0",expectedCurrency:r.expectedCurrency||"1",expectedSellerId:r.expectedSellerId||"",itemId:n.assetId||(null==l?void 0:l.itemId),itemName:n.assetName||(null==l?void 0:l.itemName),assetType:n.assetType||(null==l?void 0:l.assetType),assetGranted:null==l?void 0:l.assetGranted,assetTypeDisplayName:n.assetTypeDisplayName||(null==l?void 0:l.assetTypeDisplayName),assetTypeId:null==l?void 0:l.assetTypeId,productId:n.productId||r.productId||(null==l?void 0:l.productId),itemType:n.assetType||(null==l?void 0:l.itemType),currentTime:null==l?void 0:l.currentTime,isPurchaseEnabled:null==l?void 0:l.isPurchaseEnabled,placeproductpromotionId:null==l?void 0:l.placeproductpromotionId,userassetId:r.userAssetId||(null==l?void 0:l.userassetId)},[2,[t,r]]}})})}function de(n,e,t,a){var r="<span>"+t.get(P.purchaseSucceededRobuxBalanceMessage,{userRobuxBalance:C(e)})+"</span>",e="<div class='item-content'>\n        <div class='item-card-container item-preview'>\n          <div class='item-card-thumb'>\n            <img alt='item preview' src='"+n.itemThumbnailUrl+"'/>\n          </div>\n        </div>\n        <div class='text-center'>\n          "+t.get(P.purchaseSucceededMessage,{assetName:n.assetName})+"\n          "+r+"\n        </div>\n      </div>",r=n.assetType!==S.GAME_PASS?t.get(P.equipMyAvatarAction,{}):t.get(P.okAction,{});v.Dialog.open({titleText:t.get(P.purchaseSucceededHeading,{}),bodyContent:e,declineText:t.get(P.backToShopAction,{}),acceptText:r,acceptColor:"btn-primary-md",onAccept:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.OK),k(M.AutoPurchaseSucceedEquipMyAvatar,n.assetType);var e,t=n.itemPath;return v.Endpoints&&v.Endpoints.supportLocalizedUrls&&(t=v.Endpoints.removeUrlLocale(t)),n.assetType!==S.GAME_PASS?void 0!==(e=v.Endpoints.getAbsoluteUrl("/my/avatar"))&&""!==e&&(h.upsellUtil.expireUpsellCookie(),window.location.href=e):t.startsWith(d)?q(n.itemPath+"?#!/store"):q(n.itemPath),!1},onDecline:function(){return a.show(),h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.AutoPurchaseSucceedBackToShop,n.assetType),q(n.itemPath),!1},onCancel:function(){return a.show(),h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.PURCHASE_WARNING,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.AutoPurchaseSucceedClose,n.assetType),q(n.itemPath),!1},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,showDecline:n.assetType!==S.GAME_PASS,dismissable:!1,xToCancel:!0})}function pe(e,t){v.Dialog.open({titleText:t.get(P.errorOccuredHeading,{}),bodyContent:t.get(P.purchaseErrorOccuredMessage,{}),imageUrl:e.alertImageUrl,acceptText:t.get(P.okAction,{}),acceptColor:"btn-secondary-md",declineColor:"btn-none",dismissable:!0,allowHtmlContentInBody:!0})}var Ee=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},ye=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function ve(u,d,p,E){return Ee(this,void 0,Promise,function(){var r,o,i,l,s,c;return ye(this,function(e){switch(e.label){case 0:r={url:u,withCredentials:!0,retryable:!1,noCache:!0,noPragma:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),o={expectedCurrency:d.expectedCurrency,expectedPrice:d.expectedPrice,expectedSellerId:d.expectedSellerId,expectedPromoId:d.expectedPromoId,userAssetId:d.userAssetId},[4,I.httpService.post(r,o)];case 2:return(o=e.sent(),500===(o=o.data).statusCode)?(k(M.AutoPurchaseErrorFromPurchaseApi,d.assetType),void 0===o.showDivID&&(o.showDivID=o.showDivId),void 0===o.AssetID&&(o.AssetID=o.assetId),p.hide(),(0,v.ItemPurchase)().openErrorView(o),F(),[2,Promise.resolve()]):(d.isLibrary&&v.EventStream&&v.UrlParser&&(t=o.assetId,n=v.CurrentUser&&v.CurrentUser.userId,a=v.UrlParser.getParametersAsObject(),i={assetId:t,category:a.Category,creatorId:a.CreatorId,genre:a.GenreCsv,page:a.Page,position:a.Position,searchKeyword:a.SearchKeyword,sortAggregation:a.SortAggregation,sortType:a.SortType,userId:n,searchId:a.SearchId},v.EventStream.SendEventWithTarget("LibraryAssetAcquired","Marketplace",i,v.EventStream.TargetTypes.WWW)),k(M.AutoPurchaseSucceed,d.assetType),p.hide(),l=d.userBalance-d.expectedPrice,de(d,l,E,p),[2,Promise.resolve()]);case 3:if(i=e.sent(),p.hide(),k(M.AutoPurchaseFailed,d.assetType),"object"!=typeof(l=i)||!("responseText"in l.request))return[2,Promise.reject(l.request)];if("Bad Request"===(s=l.request).responseText)pe(d,E);else try{c=JSON.parse(s.responseText),(0,v.ItemPurchase)().openErrorView(c),F()}catch(e){return[2,Promise.reject(e)]}return[2,Promise.reject(i)];case 4:return[2]}var t,n,a})})}function he(a,r,o,i){var l;return void 0===r&&(r=void 0),Ee(this,void 0,Promise,function(){var t,n;return ye(this,function(e){return null!==(l=a.itemContainerElemClassList)&&void 0!==l&&l.contains("btn-disabled-primary")?[2,Promise.resolve()]:(t=""+v.EnvironmentUrls.apiGatewayUrl+s.replace("{productId}",a.productId),n=""+v.EnvironmentUrls.economyApi+E.replace("{productId}",a.productId),r?[2,r({productId:a.productId,expectedPrice:a.expectedPrice,expectedCurrency:a.expectedCurrency,expectedPromoId:null===(l=a.expectedPromoId)||void 0===l?void 0:l.toString(),expectedSellerId:a.expectedSellerId,userAssetId:null===(l=a.userAssetId)||void 0===l?void 0:l.toString()})]:(k(M.AutoPurchaseStarted,a.assetType),a.assetType===S.GAME_PASS?[2,ve(t,a,o,i)]:[2,ve(n,a,o,i)]))})})}var me=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},fe=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}},Ue=function(e){e=document.querySelector('.PurchaseButton[data-product-id="'+e.productId+'"]'),e=null==e?void 0:e.closest(".store-card"),e=null==e?void 0:e.querySelector(".gear-passes-asset img");return e?e.src:null},Se=function(e,t,n){if(void 0===n&&(n=window.location.pathname),n.startsWith(d)){if(!t)throw new Error("button data not exist");k(M.UpsellFromGamesPage,t.assetType);n=Ue(t);if(!n)throw k(M.UpsellThumbnailProcessFailed,t.assetType),new Error("thumbnail image url process failed");return n}return e.imageurl},Ae=HeaderScripts;function Te(e,t,n,a){var r=C(e),o=C(parseInt(n.expectedPrice,10)),e=window.location.pathname;v.Endpoints&&v.Endpoints.supportLocalizedUrls&&(e=v.Endpoints.removeUrlLocale(e));e.startsWith(d)&&(t=null!==(e=Ue(n))&&void 0!==e?e:t);r="<div class='item-card-container item-preview'>\n        <div class='item-card-thumb'>\n          <img alt='item preview' src='"+t+"' />\n        </div>\n        <div class='item-info text-name'>\n        <div class='text-overflow item-card-name'>"+(0,I.escapeHtml)()(n.itemName)+"</div>\n          <div class='text-robux item-card-price'>"+o+"</div>\n        </div>\n      </div>"+a.get(P.insufficientRobuxExceedLargestPackageMessage,{divTagStart:"<div class='modal-message-block text-center border-top'>",divTagEnd:"</div>",robuxNeeded:r});h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.VIEW_SHOWN),k(M.UpsellExceedLargestShown,n.assetType),v.Dialog.open({titleText:a.get(P.insufficientRobuxHeading,{}),bodyContent:r,declineText:a.get(P.cancelAction,{}),acceptText:a.get(P.goToRobuxStoreAction,{}),acceptColor:"btn-primary-md",onAccept:function(){var e,t;return h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.GO_TO_ROBUX_STORE),k(M.UpsellExceedLargestGoToRobuxStoreClicked,null==n?void 0:n.assetType),e=null!==(t=null===(e=Ae.deviceMeta.getDeviceMeta())||void 0===e?void 0:e.isTablet)&&void 0!==t&&t,t=null!==(t=null===(t=Ae.deviceMeta.getDeviceMeta())||void 0===t?void 0:t.isUniversalApp)&&void 0!==t&&t,window.location.href=e&&t?I.urlService.getUrlWithQueries("/Upgrades/Robux.aspx",{ctx:""}):v.Endpoints.getAbsoluteUrl("/upgrades/robux?ctx=upsell"),!1},onDecline:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellExceedLargestCancelled,null==n?void 0:n.assetType)},onCancel:function(){h.paymentFlowAnalyticsService.sendUserPurchaseFlowEvent(h.paymentFlowAnalyticsService.ENUM_TRIGGERING_CONTEXT.WEB_CATALOG_ROBUX_UPSELL,!0,h.paymentFlowAnalyticsService.ENUM_VIEW_NAME.ROBUX_UPSELL_EXCEED_LARGEST_PACKAGE,h.paymentFlowAnalyticsService.ENUM_PURCHASE_EVENT_TYPE.USER_INPUT,h.paymentFlowAnalyticsService.ENUM_VIEW_MESSAGE.CANCEL),k(M.UpsellCancelled,null==n?void 0:n.assetType)},allowHtmlContentInBody:!0,allowHtmlContentInFooter:!1,fieldValidationRequired:!0,dismissable:!0,xToCancel:!0})}var Pe=function(e,i,l,s){return new(l=l||Promise)(function(n,t){function a(e){try{o(s.next(e))}catch(e){t(e)}}function r(e){try{o(s.throw(e))}catch(e){t(e)}}function o(e){var t;e.done?n(e.value):((t=e.value)instanceof l?t:new l(function(e){e(t)})).then(a,r)}o((s=s.apply(e,i||[])).next())})},_e=function(n,a){var r,o,i,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(i=2&t[0]?o.return:t[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,t[1])).done)return i;switch(o=0,i&&(t=[2&t[0],i.value]),t[0]){case 0:case 1:i=t;break;case 4:return l.label++,{value:t[1],done:!1};case 5:l.label++,o=t[1],t=[0];continue;case 7:t=l.ops.pop(),l.trys.pop();continue;default:if(!(i=0<(i=l.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){l=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){l.label=t[1];break}if(6===t[0]&&l.label<i[1]){l.label=i[1],i=t;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(t);break}i[2]&&l.ops.pop(),l.trys.pop();continue}t=a.call(n,l)}catch(e){t=[6,e],o=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};function be(){var t=this;this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this._checkBalanceAndPurchase=function(a,r){return Pe(t,void 0,Promise,function(){var t,n=this;return _e(this,function(e){switch(e.label){case 0:if(this._state.purchased)return[2,Promise.resolve()];e.label=1;case 1:return e.trys.push([1,5,,6]),t=this.translationResource.get(P.waitingForRobuxLabel,{}),this.loadingOverlay.updateMessage(t),[4,function(){return me(this,void 0,Promise,function(){var t,n;return fe(this,function(e){switch(e.label){case 0:t=v.CurrentUser.userId,t={url:""+v.EnvironmentUrls.economyApi+o.replace("{userId}",t),withCredentials:!0,retryable:!1,noCache:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.get(t)];case 2:return 200===(n=e.sent()).status?[2,n.data.robux]:[2,Promise.reject()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}()];case 2:return t=e.sent(),(a.userBalance=t)>=a.expectedPrice?[4,he(a,r,this.loadingOverlay,this.translationResource)]:[3,4];case 3:e.sent(),this._stopPeriodicChecking(),this._state.purchased=!0,e.label=4;case 4:return this._state.purchased||(0<this._state.retryRemainTimes?(this._state.timeoutHandle=setTimeout(function(){return Pe(n,void 0,void 0,function(){return _e(this,function(e){switch(e.label){case 0:return[4,this._checkBalanceAndPurchase(a,r)];case 1:return e.sent(),[2]}})})},1e3),--this._state.retryRemainTimes):(k(M.AutoPurchaseFailedDueToStillLowBalance,null==a?void 0:a.assetType),this._processGenericErrorState(a))),[3,6];case 5:return e.sent(),k(M.AutoPurchaseFailed,null==a?void 0:a.assetType),this._processGenericErrorState(a),[3,6];case 6:return[2,Promise.resolve()]}})})},this._stopPeriodicChecking=function(){t._state.timeoutHandle&&(clearTimeout(t._state.timeoutHandle),t._state.timeoutHandle=null)},this._processGenericErrorState=function(e){t.loadingOverlay.hide(),pe(e,t.translationResource),F()},this.intl=new v.Intl,this.intlProvider=new v.TranslationResourceProvider(this.intl),this.translationResource=this.intlProvider.getTranslationResource("Purchasing.PurchaseDialog"),this.loadingOverlay=new Z}var we=(be.prototype.startItemUpsellProcess=function(r,o,i,l){var e,s,c;return void 0===l&&(l=null===(e=document.getElementById(u))||void 0===e?void 0:e.dataset),Pe(this,void 0,Promise,function(){var t,n,a;return _e(this,function(e){switch(e.label){case 0:if(!(t=l))return i(r),[2,Promise.reject(r)];if(n=h.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.exec(window.location.pathname),h.upsellUtil.constants.UPSELL_TARGET_ITEM_URL_REGEX.lastIndex=0,!Array.isArray(n))return[3,4];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,function(a,r){return x(this,void 0,Promise,function(){var t,n;return N(this,function(e){switch(e.label){case 0:t=parseInt(a.userBalanceRobux,10),n={upsell_platform:"WEB",user_robux_balance:t,attempt_robux_amount:r.expectedItemPrice},t={url:v.EnvironmentUrls.apiGatewayUrl+"/payments-gateway/v1/products/get-upsell-product",withCredentials:!0},e.label=1;case 1:return e.trys.push([1,3,,4]),[4,I.httpService.post(t,n)];case 2:return[2,e.sent()];case 3:return n=e.sent(),[2,Promise.reject(n)];case 4:return[2]}})})}(t,o)];case 2:return 200===(a=e.sent()).status?(h.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(s=null===(s=o.buyButtonElementDataset)||void 0===s?void 0:s.assetType)&&void 0!==s?s:"",!(null===(s=o.buyButtonElementDataset)||void 0===s||!s.userassetId),null!==(s=null===(s=o.buyButtonElementDataset)||void 0===s?void 0:s.isPrivateServer)&&void 0!==s&&s,null!==(s=null===(s=o.buyButtonElementDataset)||void 0===s?void 0:s.isPlace)&&void 0!==s&&s),t.thumbnailImageUrl=Se(t,o.buyButtonElementDataset),z(r,o,t,a.data,this.intl,this.translationResource,this.intlProvider),[2,Promise.resolve()]):(204===a.status?k(M.UpsellFailedDueToNoAvailablePackage,null===(s=o.buyButtonElementDataset)||void 0===s?void 0:s.assetType):k(M.UpsellFailedDueToFailedPackageRequest,null===(c=o.buyButtonElementDataset)||void 0===c?void 0:c.assetType),[3,4]);case 3:return a=e.sent(),k(M.UpsellFailed,null===(c=o.buyButtonElementDataset)||void 0===c?void 0:c.assetType),i(r),[2,Promise.reject(a)];case 4:return i(r),[2,Promise.reject(r)]}})})},be.prototype.showExceedLargestInsufficientRobuxModal=function(e,t,n,a){var r,o;void 0===a&&(a=null===(r=document.getElementById(u))||void 0===r?void 0:r.dataset),k(M.UpsellExceedLargestEntryPoint,null==t?void 0:t.assetType);var i=a;if(null==i||!i.imageurl)return k(M.UpsellExceedLargestNoThumbnailImage,null==t?void 0:t.assetType),void n();try{h.paymentFlowAnalyticsService.startRobuxUpsellFlow(null!==(o=null==t?void 0:t.assetType)&&void 0!==o?o:"",!(null==t||!t.userassetId),null!==(o=null==t?void 0:t.isPrivateServer)&&void 0!==o&&o,null!==(o=null==t?void 0:t.isPlace)&&void 0!==o&&o),Te(e,i.imageurl,t,this.translationResource),k(M.UpsellExceedLargestModalExpTrue,null==t?void 0:t.assetType)}catch(e){k(M.UpsellExceedLargestModalExpError,null==t?void 0:t.assetType),n()}},be.prototype.initiateAutoPurchase=function(o,i,l,s){var c;return void 0===l&&(l=document.getElementById(u)),void 0===s&&(s=document.getElementById("item-container")),Pe(this,void 0,Promise,function(){var t,n,a,r;return _e(this,function(e){switch(e.label){case 0:return this._state={purchased:!1,retryRemainTimes:5,timeoutHandle:null},this.loadingOverlay.show(),k(M.AutoPurchaseEntryPoint,g),se(o),[4,function(c,u,d,p){return oe(this,void 0,Promise,function(){var t,n,a,r,o,i,l,s;return ie(this,function(e){switch(e.label){case 0:return[4,ue(p,d,u)];case 1:return i=e.sent(),s=i[0],t=i[1],n=t.placeproductpromotionId,l=v.MetaDataValues&&v.MetaDataValues.getPageName()||"",a="LibraryItem"===l,r=parseInt(s.userBalanceRobux,10),o=parseInt(t.expectedCurrency,10),i=parseInt(t.expectedPrice,10),l=parseInt(t.expectedSellerId,10),s={itemContainerElemClassList:null==c?void 0:c.classList,assetType:t.assetType,assetName:(0,I.escapeHtml)()(t.itemName),expectedSellerId:l,expectedCurrency:o,expectedPrice:i,productId:t.productId,isLibrary:a,itemThumbnailUrl:s.imageurl,itemPath:p,alertImageUrl:s.alerturl,userBalance:r,itemPurchaseAjaxData:s,itemDetail:t},n&&(s.expectedPromoId=parseInt(n,10)),t.userassetId&&(s.userAssetId=parseInt(t.userassetId,10)),[2,s]}})})}(s,null==s?void 0:s.dataset,null==l?void 0:l.dataset,o)];case 1:t=e.sent(),r=this.translationResource.get(P.purchasingTheItemLabel,{}),n=t.userBalance,a=t.expectedPrice,e.label=2;case 2:return(e.trys.push([2,6,,7]),o.startsWith(d)&&null!==(c=document.getElementById("tab-store"))&&void 0!==c&&c.click(),a<n)?(this.loadingOverlay.updateMessage(r),[4,he(t,i,this.loadingOverlay,this.translationResource)]):[3,4];case 3:return e.sent(),this._state.purchased=!0,[2,Promise.resolve()];case 4:return[4,this._checkBalanceAndPurchase(t,i)];case 5:return e.sent(),[3,7];case 6:return r=e.sent(),k(M.AutoPurchaseFailed,null==t?void 0:t.assetType),re(b.CONTEXT_NAME.UPSELL_FAILED,{itemPurchaseObj:t,error:r}),F(),[3,7];case 7:return[2,Promise.resolve()]}})})},be);void 0===window.Roblox&&(window.Roblox={}),void 0===window.Roblox.ItemPurchaseUpsellService&&(window.Roblox.ItemPurchaseUpsellService=new we)}();
//# sourceMappingURL=https://js.rbxcdn.com/fe6c2977215f21686bfd334f9aeebb12-itemPurchaseUpsell.bundle.min.js.map

/* Bundle detector */
window.Roblox && window.Roblox.BundleDetector && window.Roblox.BundleDetector.bundleDetected("ItemPurchaseUpsell");